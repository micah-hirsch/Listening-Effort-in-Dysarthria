---
title: "Main Analysis"
author: "Micah E. Hirsch"
date: "2024-05-13"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

The purpose of this document is to analyze and report findings related to M. Hirsch's dissertation project. The data preparation and analysis was conducted using R Version 4.3.3.

```{r, echo = F, warning = F, messsage = F}

# Load in Needed Packages

library(rio)
library(tidyverse)
library(mgcv)
library(itsadug)
library(irr)
library(ggpubr) # installl.packages("ggpubr")
library(gt) # install.packages("gt")
library(gtsummary) # install.packages("gtsummary")
library(glmmTMB) # install.packages("glmmTMB")
library(performance) # install.packages("performance")
library(sjPlot) # install.packages("sjPlot")


```


# Listener Demographics

The table below shows the demographic information for the listeners in this study. A total of 39 listeners were recruited to participate in the study. However, 1 participant withdrew from the study (their data was already destroyed before exporting the listener demographic dataset) and 4 participants were dismissed due to difficulty during the calibration phase of the study. Therefore, there ended up being 34 total listeners in this study. The demographic table shows the demographic information for the 34 participants included in the study (complete) and the 4 who were not able to be tracked by the eye-tracking camera (incomplete).

All listeners reported being a fluent speaker of English. However, two participants noted that their native language was different than American English. Their reported native languages were Turkish and Spanish.

```{r, warning = F, message = F}

demo <- rio::import("Cleaned Data/cleaned_listener_demo.csv") |>
  dplyr::mutate(gender = factor(gender, levels = c("Man", "Woman", "Nonbinary", "Questioning", "Prefer not to answer")),
                ethnicity = factor(ethnicity, levels = c("Hispanic/Latino(a/e)", "Not Hispanic/Latino(a/e)", "Prefer not to answer")),
                race = factor(race, levels = c("white/Caucasian", "Black/African American", "Asian/Asian American",
                                               "Native Hawaiian or Other Pacific Islander", "Native American or Alaska Native",
                                               "Biracial or Multiracial", "Prefer not to answer", "Race not listed")),
                native_lang = factor(native_lang, c("American English", "Not American English")))
  
demo_table <- demo |>
  dplyr::select(age, gender, ethnicity, race, native_lang, pupil_complete) |>
  tbl_strata(
    strata = pupil_complete,
    ~.x |>
      tbl_summary(type = list(age ~ "continuous",
                          gender ~ "categorical",
                          ethnicity ~ "categorical",
                          race ~ "categorical",
                          native_lang ~ "categorical"),
                  statistic = list(all_continuous() ~ "{mean} ({sd}, {min}-{max})",
                               all_categorical() ~ "{n} ({p}%)"),
                  digits = list(everything() ~ c(2)),
                  label = list(age ~ "Age",
                           gender ~ "Gender",
                           ethnicity ~ "Ethnicity",
                           race ~ "Race",
                           native_lang ~ "Native Language"))
    ) |>
  as_gt()

demo_table

demo_table |>
  gt::gtsave("Tables/demographic_table.html")

```


```{r, echo = F, warning = F, message = F}

# Removing unneeded items from the environment
rm(demo, demo_table)

```


# Descriptives

## Transcription Reliability

Phrase repetition accuracy was determined by transcriptions of the listener's spoken response. These reponses were transcribed by 2 research assistants. To determine interrater reliability, each RA transcribed at least 20% of the other RA's listener reponses. Fleiss' kappa was then used to calculated interrater reliability for the resulting phrase repetition accuracy determination (accurate or inaccurate). Based on the result below, our interrater reliability for phrase repetition accuracy was strong.

```{r, warning = F, message = F}

phrase_acc <- rio::import("Cleaned Data/repetition_accuracy.csv")

phrase_acc <- phrase_acc |>
  dplyr::mutate(rep_acc = ifelse(initial_response == "missing data", NA, 
                                 ifelse(target_number == correct_words_initial, "accurate", "inaccurate")),
                rep_acc_rel = ifelse(rel_response == "missing data", NA, 
                                 ifelse(target_number == correct_words_rel, "accurate", "inaccurate")))

reliability <- phrase_acc |>
  dplyr::filter(!is.na(rep_acc_rel)) |>
  dplyr::select(rep_acc, rep_acc_rel)

# Computing Fleiss' Kappa

kappam.fleiss(reliability, detail = T)

```

## Speaker Characteristics







# Pupil Dilation

```{r}



```


